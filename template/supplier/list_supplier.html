{% extends '../base.html' %}
{% block content %}

<div class="card mb-3 p-1" data-date="{{ i.registration_date }}">
  <div class="card-body p-2 overflow-hidden">
    <div class="row">
      <div class="col-md-3 col-12">
        <h5>Lista de proveedores</h5>
      </div>
      <div class="col-md-2 col-12 ml-auto">
        {% for i in request.session.permission %}
          {% if i == "Creador" or i == "Todos" %}
            <button class="btn btn-info Add_Supplier">Crear proveedor</button>
          {% endif %}
        {% endfor %} 
      </div>
    </div>
  </div>
</div>
<input type="text" id="searchInput" placeholder="Buscar proveedor..." autofocus class="form-control form-control-sm mb-2 searchInput">

<div class="card card_search">
  <div class="card-body p-2 overflow-hidden">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th class="text-dark">CC / NIT</th>
            <th class="text-dark">Razón Social</th>
            <th class="text-dark">Teléfono</th>
            <th class="text-dark">Correo Electrónico</th>
            {% if request.session.permission %}
              {% for j in request.session.permission %}
                  {% if j == "Editor" or j == "Todos" or j == "Eliminador" %}
                  <th class="text-dark">Acciones</th>
                {% endif %}
              {% endfor %}
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for i in page_obj %}
            <tr>
              <td class="text-dark cc_nit">{{i.documentI}}</td>
              <td class="text-dark razon_social">{{i.name}}</td>
              <td class="text-dark">{{i.phone}}</td>
              <td class="text-dark">{{i.email}}</td>
              <td>
                {% for j in request.session.permission %}
                  {% if j == "Editor" or j == "Todos" %}
                    <a href="{% url 'Edit_Supplier' i.pk %}" class="btn btn-primary edit" id="{{i.pk}}">Editar</a>
                  {% endif %}
                  {% if j == "Eliminador" or j == "Todos" %}
                    <button class="btn btn-danger delete" id="{{i.pk}}">Eliminar</button>
                  {% endif %}
                {% endfor %}              
              </td>  
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if page_obj.has_other_pages %}
<div class="card-footer border-top d-flex justify-content-center">
    {% if page_obj.has_previous %}
      <a class="btn btn-falcon-default btn-sm me-2" href="?page=1" data-bs-toggle="tooltip" data-bs-placement="top" title="First">
          <span class="fas fa-chevron-left"></span>
      </a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
        <a class="btn btn-sm btn-falcon-default me-2 active">{{ num }}</a>
      {% else %}
        <a class="btn btn-sm btn-falcon-default me-2" href="?page={{ num }}">{{ num }}</a>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
    <a class="btn btn-falcon-default btn-sm" href="?page={{ page_obj.paginator.num_pages }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Last">
        <span class="fas fa-chevron-right"></span>
    </a>
    {% endif %}
</div>
{% endif %}

{% endblock %}
{% block script %}

  <script>
    $(document).ready(function(){

      console.clear()

      $(".searchInput").on("input", function() {
        var searchText = $(this).val().toLowerCase();
        $("table tbody tr").each(function() {
          var ccNitText = $(this).find(".cc_nit").text().toLowerCase();
          var razonSocialText = $(this).find(".razon_social").text().toLowerCase();
          if (razonSocialText.includes(searchText) || ccNitText.includes(searchText)) {
            $(this).show();
          } else {
            $(this).hide();
          }
        })
      })

      $(".Add_Supplier").click(function(){
        location.href = "{% url 'Create_Supplier' %}"
      })

      $(document).on('click','.delete',function(){
        $(this).closest('tr').remove();
        $.ajax({
          url:"{% url 'Delete_Supplier' %}",
          data:{'pk_suppplier':this.id},
          success:function(e){
            e = JSON.parse(e)
            if(e.result){
              var notification = new Notification("REALIZADO", {
                body: e.message
              })
            }
            else{
              var notification = new Notification("ERROR", {
                body: e.message
              }) 
            }
          }
        })
      })

    })
  </script>

{% endblock %}